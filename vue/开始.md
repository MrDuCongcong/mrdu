# 开始

## 源码目录

## 入口在哪里

自前端工程化以来，随着npm和yarn这样的包管理工具的应用，一切都变得可配置起来。而packag.json作为npm主要配置文件，其中有关于当前工程的一切配置信息。当然，我们阅读源码的时候其实更关注的是其中的"scripts"字段下配置的命令。

![image-20210324230229266](D:\front\learn\mrdu\assets\scripts.png)

<div align="center">图1：Vue源码中配置的部分命令</div>

我们先看的“dev”命令。Vue源码并不是像我们的普通项目一样直接跑起来，而是运行了一个rollup工具，对源码进行打包, rollup后面跟的短字符都是它的命令行选项。事实上当我们运行`npm run dev`的时候，后边的内容是交给node执行的。

`-w ` 表示对源文件进行监听，当文件改变时重新打包；

`-c` 表示rollup使用配置文件，其配置文件的路径是scripts/config.js。

`--environment`是对环境变量的配置。在开发中，我们一般需要针对生产环境和开发环境使用不同的配置文件，如：prod.config.js、dev.config.js，但是开发环境和生产环境一般只有很少的一部分配置不同，因此无谓配置两个文件。这时候就可以直接通过`--environment`选项来配置一些环境变量，其后面更的是键值对，使用‘：’分隔。比如上面的配置是`--environment TARGET:web-full-dev`，此时访问`process.env.TARGET`的值就会是web-full-dev。

最后的`--sourcemap`表示生成sourcemap文件。

## sourcemap

到底那么是sourcemap?其实sourcemap是浏览器支持的一种源码映射方式。一般来讲我们在浏览器中运行的js代码是经过编译的，我们很难读懂，因此给我们的开发调试带来了很大的困难，所以我们需要一种将“运行的代码”与“开发的代码”相关联的一种机制，所以sourcemap诞生了。通常，我们出于以下目的对我们的源码进行编译：

- 代码压缩。体积太大的js、html、css等文件会大大增加浏览器文件加载的时间，从而对用户体验造成障碍，所以我们会对代码进行编译，去掉无用的代码、空格、换行等无用字符。
- 文件合并。网络资源是宝贵的，减少文件的数量能够减少请求的次数。
- 盛行的typescript、flow.js等强类型语言最终都需要编译成js代码。

当我们开启sourcemap的时候，通常编译后会至少包含两个文件：源文件和映射文件，在源文件的最后一行，会有下面格式的注释，来指明映射文件的路径。

```javascript
//# sourceMappingURL=vue.js.map
```

映射文件通常以“.map”作后缀。如Vue源码。

![image-20210325001336921](D:\front\learn\mrdu\assets\soucemap.png)

创建源代码映射的第一版是供[Closure Inspector](https://code.google.com/archive/p/closure-inspector/) 使用的 。现行的sourcemap是[第三版](https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit)，由Google和Mozilla的代表共同编写。

## 我们该如何调试源码