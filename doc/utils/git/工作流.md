# 工作流

在开发团队中通常使用版本控制系统，来协调项目开发过程中的工作流程， 因此合理的工作流程能够更大程度的发挥团队成员之间协作效率，并且能够减少项目管理的难度，使得项目的开发、发布过程更加流畅。

目前被广泛使用的3种工作流（work flow）是Git Flow、GitHub Flow和GitLab Flow，下面我们介绍一下这3种工作流。

## Git flow——以发布为中心

Git flow是最早出现，并且使用最多的工作流。荷兰程序员 Vincent Driessen 曾发表了一篇《[A successful Git branching model](https://nvie.com/posts/a-successful-git-branching-model/)》博客 ，让该分支策略 广为人知。下面这张图出自该博客，描述了这一工作流。

<img src="D:\front\learn\mrdu\assets\git\GitFlowModel.png" style="zoom: 50%;" />

<center>图一  Git Flow</center>

从上面这张图，我们可以轻易的看出，Git Flow使用分支名称来表示开发流程中开发状态的转移。这个工作流中最大的亮点在于，考虑了紧急状态下的bug修复，体现在上面的hotfix分支上面。而缺点在于，我们在熟练使用该工作流的之前，必须记忆每个分支所表示的状态，对整个开发流程进行系统的学习，因为分支是与开发状态相对应的，所以只有掌握每个分支所表示的状态和含义，才能从正确的创建分支或者正确的合并分支。下面，我们首先介绍一下，各分支所表示的状态及其含义。

首先，项目中长期存在两个分支：master和develop分支。

- master分支。master分支需要时常保持着软件可以正常运行的状态。由于要维持这一 状态，所以不允许开发者直接对 master 分支的代码进行修改和提交。其他分支的开发工作只有进展到可以发布的程度后，将会与 master 分支 进行合并，而且这一合并只在成品发布时进行。发布时会附加包含版本 编号的 Git 标签（Tag）。
- develop分支。与master分支相同，develop分支也不允许开发者直接修改和提交。develop分支维持着开发过程中的最新代码。程序员需要以develop分支为起点，新建feature分支，来完成新功能的添加或者bug的修复。

除了上面的两个长期分支，该工作流中还存在三个短期分支：feature、release和hotfix分支。这三个分支在开发完成，并合并到其它分支后，就可以在适当的时机删除了。

- feature分支。该分支被称为功能分支，或者特性分支。它以develop分支为起点，一切直接对代码的修改工作，都必须提交到该分支。该分支的工作流程如下：

  1. 从develop分支创建feature分支。
  2. 在feature分支完成功能开发。
  3. 向develop分支发起pull request。
  4. 待其他开发者审核后，将feature分支合并到develop分支。

  当feature分支合并到develop分支后，该feature分支就失去了作用，可以在适当时机删除。

- release分支。release分支只处理发布前的准备工作，比如版本号的修改，或者是一些元数据的修改。如果产品部署到预演环境，发现BUG时，相关的修正代码也可以提交到该分支。但是当产品出现需求变更，或者功能添加时，就绝不允许提交到该分支。

- hotfix分支。hotfix并不是开发计划内的分支，而是一个紧急应对措施，只有当发布正式版本出现BUG，严重到开发方不得不立即处理，无法等到下一个正式发布版本时，hotfix分支才会被创建。该分支的创建以master分支为起点，在不影响developer分支上正常开发的情况下，由其他开发人员进行紧急的线上问题处理。

上面就是该工作流中所有分支及其状态的介绍，下面我们来了解该工作流的工作过程。

1. 在项目中创建master分支。

2. 以master分支为起点创建develop分支。今后团队中的所有成员都以这个分支为基础进行开发。

3. 从develop分支创建feature分支。进行功能的开发或问题的修正。

4. 在feature分支进行多次提交，实现功能目标后，将其合并到develop分支

5. 重复3和4这两个过程，不断实现功能，直到产品可以发布。

6. 以develop分支为起点，创建release分支，进行发布前的准备工作。

7. 向release分支提交版本号的修改、版本发布信息等信息。

8. 将release分支合并到master分支，并部署到预演环境。

9. 当预演环境出现BUG后，可以在release分支进行修复。之后执行第8步，再次部署到预演环境。

10. 当预演环境不再出现问题，我们完成发布前的全部修正工作后，就结束release分支的工作。

11. 将release分支合并到master分支，并在master分支添加一个与版本号相同的标签。今后遇到什么问题，我们就可以通过标签，将代码回溯到相应版本。

12. 将release分支合并到master分支，至此，我们就结束了全部的release分支工作，该分支就可以被删除了。

13. 当线上运行的发布版本出现紧急问题，并不得不立即修复时，而此时的develper分支正在开发新的功能，而无法面向用户发布时。我们将代码master的代码回溯到相应版本，然后以该版本为起点，创建hotfix分支，进行问题修复。一般来讲，我们都拉取的是最新版本的代码。

14. 在hotfix分支，完成线上问题的修复时，将其合并到master分支。并部署到预演环境测试。

15. 当问题被修复后，修改hotfix版本的修复版本号和修复信息，并提交。

16. 将hotfix分支合并到master分支后，在master分支后，在master分支添加一个新的修复版本号的标签。

17. 此时，master分支的BUG问题已经被修复了，但是develop分支依然存在该问题，因此需要将hotfix分支合并到develop分支。需要注意的是，如果hotfix分支与develop分支合并过程中出现异常，切不可在release分支处理该问题，而是先完成合并工作，然后在develop分支处理该问题。

18. 当release分支成功合并到develop分支后，release分支就完成了使命，可以被删除。

    > 为了保证流程的简单性，release分支和hotfix分支一定要保证对master分支的最小限度的修改。

    以上就是Git Flow使用的详细流程了。下面，我们基于上面描述的工作流进行实践。

    ### 体验Git Flow



![](D:\front\learn\mrdu\assets\git\GitFlow.png)

## GitHub flow——以部署为中心

## GitLab flow 

<center>
 <img src="D:\front\learn\mrdu\assets\git\GitLabFlow1.png" style="zoom: 67%;" />
</center>
<img src="D:\front\learn\mrdu\assets\git\GitLabFlow2.png" style="zoom: 67%;" />

<img src="D:\front\learn\mrdu\assets\git\GitLabFlow3.png" style="zoom:67%;" />

## 参考文档

[1]: https://www.git-tower.com/learn/git/ebook/cn/command-line/advanced-topics/git-flow	"git-flow 的工作流程"
[2]: https://morningspace.github.io/tech/git-workflow-4/	"Git工作流面面观——Gitflow工作流"
[3]: https://docs.gitlab.cn/jh/topics/gitlab_flow.html	"GitLab Flow 官网介绍"

[4]: http://www.ruanyifeng.com/blog/2015/12/git-workflow.html	"Git 工作流程"
[5]: https://ithelp.ithome.com.tw/articles/10228195 "GIT 团队协作  谈流程管理 GitLab Flow"

